<div class="popup-box">
  <button class="close-btn" (click)="fermerPopup()">X</button>

  <h2>RÃ©seau de Mutualisation</h2>
  <p class="instruction">Clique sur deux Ã©tablissements pour les relier et partager les ressources !</p>

  <div class="game-board">
    <svg class="connections-layer">
      <line *ngFor="let link of links" 
            [attr.x1]="link.x1 + '%'" 
            [attr.y1]="link.y1 + '%'" 
            [attr.x2]="link.x2 + '%'" 
            [attr.y2]="link.y2 + '%'" 
            stroke="#27ae60" 
            stroke-width="4" 
            stroke-dasharray="5,5" /> </svg>

    <div *ngFor="let school of schools" 
         class="school-node"
         [style.left.%]="school.x"
         [style.top.%]="school.y"
         [class.selected]="selectedSchool === school"
         [class.connected]="school.isConnected"
         (click)="selectSchool(school)">
        <div class="icon" [style.borderColor]="school.color">
          <img [src]="'assets/mutualisation/' + school.img" alt="batiment" class="school-img">
      </div>
      <span class="name">{{ school.name }}</span>
      
    </div>

  </div>


  <div class="stats-panel" *ngIf="links.length > 0">
    <div class="stat-item">
    <strong>{{ co2Saved }} kg</strong> de CO2 Ã©vitÃ©
    </div>
    <div class="stat-item">
      <strong>{{ moneySaved }} â‚¬</strong> Ã©conomisÃ©s
    </div>
    <div class="message-nird" *ngIf="isNetworkConnected">
     Bravo ! Territoire 100% NIRD !
    </div>
  </div>


  <div class="victory-overlay" *ngIf="isNetworkConnected && (!isOptimizing || isMaxedOut)">
  <div class="victory-box">
    
    <div *ngIf="isMaxedOut">
        <h1>ğŸŒŸ INCROYABLE ! ğŸŒŸ</h1>
        <p>Votre rÃ©seau est ultra-rÃ©silient et optimisÃ© au maximum !</p>
    </div>

    <div *ngIf="!isMaxedOut">
        <h1>ğŸ† RÃ‰SEAU CONNECTÃ‰ !</h1>
        <p>Bravo, tous les Ã©tablissements sont reliÃ©s.</p>
        <p class="suggestion">ğŸ’¡ Astuce : CrÃ©er plus de liens renforce le rÃ©seau et augmente les Ã©conomies.</p>
    </div>

    <div class="final-stats">
       <span>ğŸŒ± {{ co2Saved }} kg CO2</span>
       <span>ğŸ’° {{ moneySaved }} â‚¬</span>
    </div>

    <div class="actions">
        <button class="btn-optimize" *ngIf="!isMaxedOut" (click)="startOptimization()">
            ğŸš€ Optimiser encore (+ de gains)
        </button>

        <button class="btn-restart" (click)="fermerPopup()">
            {{ isMaxedOut ? 'Mission TerminÃ©e' : 'Ã‡a me suffit, terminer' }}
        </button>
    </div>

  </div>
</div>
</div>